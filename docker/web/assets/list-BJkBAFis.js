import{x as U,u as Y,A,e as s,C as K,p as d,q as c,v as l}from"./index-462V7mWl.js";import{n as N}from"./index.browser-C3Hd0ZRB.js";const B=U("list",()=>{const u=Y(),F=A();function I(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function w(e,t,a){const o=I(new Date(e)),r=(a-1)*7,m=(o.getDay()-t+7)%7,f=r+m;return new Date(o.getTime()-f*24*60*60*1e3).getTime()}function y(e){const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-e,r=Math.floor(o/(1e3*60*60*24)),i=Math.floor(r/7);return Math.max(i,0)+1}const D=s([{name:"所有",code:"none"},{name:"进行中",code:"progress"},{name:"更新中",code:"onUpdate"},{name:"已完结",code:"updateDone"},{name:"已看完",code:"watchDone"},{name:"搜索",code:"search"},{name:"更新周",code:"weekday"}]),g=s(D.value[1]),v=s([{name:"星期一",code:1},{name:"星期二",code:2},{name:"星期三",code:3},{name:"星期四",code:4},{name:"星期五",code:5},{name:"星期六",code:6},{name:"星期日",code:0}]),T=s(v.value[0]),$=s(0),k=s(""),E=s(0),j=s(20),M=s([]);async function n(){const{data:e}=await d.get(`${c}/api/list/get`,{params:{offset:E.value,limit:j.value,filter:g.value.code,param:g.value.code=="weekday"?T.value.code:k.value},headers:{token:l().token}});e.ok&&(M.value=e.msg.data,$.value=e.msg.length)}function x(e){return e==0?"/":new Date(e).toLocaleString("zh-CN",{weekday:"long"})}function b(e){return e.time==0?!1:y(e.time)<e.episode}function h(e){return e.time==0||y(e.time)>e.episode?e.episode:y(e.time)}function z(e){return e.now/h(e)*100}K(k,()=>{g.value.code=="search"&&n()});async function C(e){if(e.now>=h(e))return;const{data:t}=await d.post(`${c}/api/list/edit`,{data:{...e,now:e.now+=1}},{headers:{token:l().token}});t.ok?n():u.add({severity:"error",summary:"更新失败",detail:t.msg,life:3e3})}async function S(e){if(e.now<=1)return;const{data:t}=await d.post(`${c}/api/list/edit`,{data:{...e,now:e.now-=1}},{headers:{token:l().token}});t.ok?n():u.add({severity:"error",summary:"更新失败",detail:t.msg,life:3e3})}async function W(e,t,a,o,r,i){const m=Date.now(),f={id:N(),title:e,episode:a,now:o,time:t?w(m,i,r):0},{data:p}=await d.post(`${c}/api/list/add`,{data:f},{headers:{token:l().token}});p.ok?n():u.add({severity:"error",summary:"添加失败",detail:p.msg,life:3e3})}async function q(e,t,a,o,r,i,m){const f=Date.now(),p={id:e,title:t,episode:o,now:r,time:a?w(f,m,i):0},{data:P}=await d.post(`${c}/api/list/edit`,{data:p},{headers:{token:l().token}});P.ok?n():u.add({severity:"error",summary:"更新失败",detail:P.msg,life:3e3})}function L(e,t){F.require({target:e.currentTarget,position:"bottomleft",message:"你确定要删除这项吗",rejectProps:{label:"取消",severity:"secondary",outlined:!0,size:"small"},acceptProps:{label:"删除",severity:"danger",size:"small"},accept:async()=>{const{data:a}=await d.delete(`${c}/api/list/del/${t.id}`,{headers:{token:l().token}});a.ok?n():u.add({severity:"error",summary:"删除失败",detail:a.msg,life:3e3})},reject:()=>{}})}return{deleteItem:L,editItem:q,addItem:W,getTimestampOfFirstEpisode:w,add:C,minus:S,searchKeyWord:k,calProgress:z,analyseEpisode:h,calculateEpisodesReleased:y,offset:E,getWeekday:x,onUpudate:b,selectedFilter:g,filters:D,selectedWeekday:T,weekdays:v,length:$,list:M,getList:n}});export{B as l};
