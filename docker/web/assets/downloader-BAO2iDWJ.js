import{x as h,u as x,e as t,p as r,q as d,v as i,N as m}from"./index-462V7mWl.js";import{n as w}from"./index.browser-C3Hd0ZRB.js";const S=h("downloader",()=>{const a=x(),o=t(!1),c=t([{id:"mikan",text:"Mikan"},{id:"acgrip",text:"Acgrip"}]),y=t(c.value[0]),f=t("15"),l=t(""),n=t(""),v=t([]),p=t([]),u=async()=>{const{data:s}=await r.get(`${d}/api/downloader/get`,{headers:{token:i().token}});if(s.ok){const e=s.msg;o.value=e.running,y.value=e.type=="mikan"?c.value[0]:c.value[1],f.value=e.freq.toString(),l.value=e.link,n.value=e.secret,v.value=e.list,p.value=e.exclude}else a.add({severity:"error",summary:"请求失败",detail:s.msg,life:3e3})},k=async(s=!1)=>{if(l.value.length==0){a.add({severity:"error",summary:"更新失败",detail:"Aria 链接不能为空",life:3e3});return}else if(n.value.length==0){a.add({severity:"error",summary:"更新失败",detail:"Aria 密钥不能为空",life:3e3});return}else if(v.value.length==0){a.add({severity:"error",summary:"更新失败",detail:"你没有添加任何番剧列表",life:3e3});return}const{data:e}=await r.post(`${d}/api/downloader/save`,{data:{link:l.value,secret:n.value,freq:parseInt(f.value),type:y.value.id}},{headers:{token:i().token}});s||(e.ok?a.add({severity:"success",summary:"更新成功",detail:"已更新到数据库",life:3e3}):a.add({severity:"error",summary:"更新失败",detail:e.msg,life:3e3}))};return{toggleRun:async s=>{if(s){if(l.value.length==0){a.add({severity:"error",summary:"运行失败",detail:"没有配置Aria地址",life:3e3}),m(()=>{o.value=!1});return}else if(n.value.length==0){a.add({severity:"error",summary:"运行失败",detail:"没有配置Aria密钥",life:3e3}),m(()=>{o.value=!1});return}await k(!0);const{data:e}=await r.post(`${d}/api/download/run`,{},{headers:{token:i().token}});if(!e.ok){a.add({severity:"error",summary:"运行失败",detail:e.msg,life:3e3}),m(()=>{o.value=!1});return}}else{const{data:e}=await r.post(`${d}/api/download/stop`,{},{headers:{token:i().token}});if(!e.ok){a.add({severity:"error",summary:"运行失败",detail:e.msg,life:3e3}),m(()=>{o.value=!0});return}}},delFromExclude:async s=>{const{data:e}=await r.delete(`${d}/api/downloader/exclude/del/${s}`,{headers:{token:i().token}});e.ok?(u(),a.add({severity:"success",summary:"删除成功",detail:"已更新到数据库",life:3e3})):a.add({severity:"error",summary:"删除失败",detail:e.msg,life:3e3})},addToExclude:async s=>{const{data:e}=await r.post(`${d}/api/downloader/exclude/add`,{data:{id:w(),key:s}},{headers:{token:i().token}});e.ok?(u(),a.add({severity:"success",summary:"添加成功",detail:"已更新到数据库",life:3e3})):a.add({severity:"error",summary:"添加失败",detail:e.msg,life:3e3})},delFromList:async s=>{const{data:e}=await r.delete(`${d}/api/downloader/list/del/${s}`,{headers:{token:i().token}});e.ok?(u(),a.add({severity:"success",summary:"删除成功",detail:"已更新到数据库",life:3e3})):a.add({severity:"error",summary:"删除失败",detail:e.msg,life:3e3})},addToList:async(s,e)=>{const{data:g}=await r.post(`${d}/api/downloader/list/add`,{data:{id:w(),title:s,ass:e}},{headers:{token:i().token}});g.ok?(u(),a.add({severity:"success",summary:"添加成功",detail:"已更新到数据库",life:3e3})):a.add({severity:"error",summary:"添加失败",detail:g.msg,life:3e3})},save:k,getList:u,exclude:p,list:v,secret:n,link:l,freq:f,rssTypes:c,rssSelected:y,running:o}});export{S as d};
