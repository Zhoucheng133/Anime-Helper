import{l as b}from"./list-BJkBAFis.js";import{_ as U}from"./loading.vue_vue_type_script_setup_true_lang-BSSBdued.js";import{x as j,e as d,u as L,p as R,q as A,v as I,d as B,c as y,F as $,i as s,g as a,w as k,h as r,a as z,j as C,o as f,y as F,z as H,f as T,b as S,t as q,n as D}from"./index-462V7mWl.js";import{s as E,a as M,b as G}from"./index.browser-C3Hd0ZRB.js";import{s as x}from"./index-BvykPrIl.js";import{s as J,a as K,b as O,c as P,d as Q}from"./index-C7CyjqcS.js";const _=j("calendar",()=>{const w=d(),c=L();return{list:w,getList:async()=>{const{data:n}=await R.get(`${A}/api/calendar/get`,{headers:{token:I().token}});n.ok?w.value=n.msg:c.add({severity:"error",summary:"请求失败",detail:n.msg,life:3e3})}}}),X={class:"flex items-center gap-2 mb-4"},Y={class:"flex items-center gap-2 mb-4"},Z={class:"flex items-center gap-2 mb-4"},ee={class:"flex items-center gap-2 mb-4"},le={key:0,class:"flex items-center gap-2 mb-4"},ae={key:1,class:"flex items-center gap-2 mb-4"},se={class:"flex justify-end gap-2"},te=B({__name:"add",setup(w,{expose:c}){const u=d(),n=d(!1),i=d(b().weekdays[0]),m=L(),p=d(""),t=d(!0),o=d(""),g=d("0"),v=d(""),N=d(""),W=async(V,e)=>{u.value.loadingHandler(!0,"加载番剧信息"),N.value=V.id,n.value=!0,p.value=V.title,i.value=b().weekdays[e==0?6:e-1];const{data:l}=await R.get(`${A}/api/calendar/info/${V.id}`,{headers:{token:I().token}});l.ok?(o.value=l.msg.eps,v.value=l.msg.updates):m.add({severity:"error",summary:"获取信息失败",detail:l.msg,life:3e3}),u.value.loadingHandler(!1,"加载番剧信息")},h=async()=>{if(p.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"标题不能为空",life:3e3});return}else if(o.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"集数不能为空",life:3e3});return}else if(g.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(v.value.length==0&&t.value){m.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}b().addItem(p.value,t.value,parseInt(o.value),parseInt(g.value),parseInt(v.value),i.value.code),_().getList(),n.value=!1};return c({showAddHandler:W}),(V,e)=>(f(),y($,null,[s(a(E),{visible:n.value,"onUpdate:visible":e[7]||(e[7]=l=>n.value=l),modal:"",header:"添加到列表...",style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1},{default:k(()=>[r("div",X,[s(a(M),{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value=l),inputId:"update",binary:""},null,8,["modelValue"]),e[8]||(e[8]=r("label",{for:"update"}," 当前在更新 ",-1))]),r("div",Y,[e[9]||(e[9]=r("label",{for:"title",class:"font-semibold w-20"},"标题",-1)),s(a(x),{size:"small",id:"title",class:"flex-auto",autocomplete:"off",modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value=l)},null,8,["modelValue"])]),r("div",Z,[e[10]||(e[10]=r("label",{for:"episode",class:"font-semibold w-20"},"集数",-1)),s(a(x),{type:"number",size:"small",id:"episode",class:"flex-auto",autocomplete:"off",modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value=l),min:"1"},null,8,["modelValue"])]),r("div",ee,[e[11]||(e[11]=r("label",{for:"watchTo",class:"font-semibold w-20"},"观看至",-1)),s(a(x),{type:"number",size:"small",id:"watchTo",class:"flex-auto",autocomplete:"off",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),min:"0",max:t.value?v.value:o.value},null,8,["modelValue","max"])]),t.value?(f(),y("div",le,[e[12]||(e[12]=r("label",{for:"updateTo",class:"font-semibold w-20"},"更新至",-1)),s(a(x),{type:"number",size:"small",id:"updateTo",class:"flex-auto",autocomplete:"off",modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),min:"1",max:o.value},null,8,["modelValue","max"])])):z("",!0),t.value?(f(),y("div",ae,[e[13]||(e[13]=r("label",{for:"updateWeek",class:"font-semibold w-20"},"更新周",-1)),s(a(G),{size:"small",id:"updateWeek",modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value=l),options:a(b)().weekdays,"scroll-height":"20rem",optionLabel:"name"},null,8,["modelValue","options"])])):z("",!0),r("div",se,[s(a(C),{type:"button",label:"取消",severity:"secondary",onClick:e[6]||(e[6]=l=>n.value=!1),size:"small"}),s(a(C),{type:"button",label:"添加",onClick:h,size:"small"})])]),_:1},8,["visible"]),s(U,{ref_key:"loadingRef",ref:u},null,512)],64))}}),oe={class:"page"},fe=B({__name:"calendar",setup(w){document.title="AnimeHelper | 每日放送";const c=d(),u=d(),n=(i,m)=>{i.added||c.value.showAddHandler(i,m)};return F(async()=>{u.value.loadingHandler(!0,"获取每日放送列表"),await _().getList(),u.value.loadingHandler(!1,"获取每日放送列表")}),(i,m)=>(f(),y("div",oe,[s(a(J),{multiple:!0,value:[0,1,2,3,4,5,6]},{default:k(()=>[(f(!0),y($,null,H(a(_)().list,(p,t)=>(f(),T(a(K),{key:t,value:t},{default:k(()=>[s(a(O),null,{default:k(()=>[S(q(a(b)().weekdays[t==0?6:t-1].name),1)]),_:2},1024),s(a(P),null,{default:k(()=>[(f(!0),y($,null,H(p,(o,g)=>(f(),T(a(Q),{rounded:"",key:o.id,value:o.title,class:D(o.added?"select-none m-1":"select-none m-1 cursor-pointer"),severity:o.added?"warn":"secondary",onClick:v=>n(o,t)},null,8,["value","class","severity","onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),s(te,{ref_key:"addRef",ref:c},null,512),s(U,{ref_key:"loadingRef",ref:u},null,512)]))}});export{fe as default};
