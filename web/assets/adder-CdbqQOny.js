import{d as y,r as d,a as f,b as g,m as v}from"./index-iTMpOYeB.js";import{t as p}from"./token-zDjAYmwP.js";function _(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}function x(t,e,n){const l=_(new Date(t)),o=(n-1)*7,r=(l.getDay()-e+7)%7,i=o+r;return new Date(l.getTime()-i*24*60*60*1e3).getTime()}function m(t){const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-t,o=Math.floor(l/(1e3*60*60*24)),u=Math.floor(o/7);return Math.max(u,0)+1}const T=t=>t.time==0||m(t.time)>t.episode?t.episode:m(t.time),E=y("list",()=>{let t=d(!0),e=d([]);const n=async()=>{const a=(await f.get(`${g}/api/list`,{headers:{token:p().token}})).data;a.ok?e.value=a.msg.reverse():v.error("获取列表失败: "+a.msg),t.value=!1},l=async a=>{if(a.now==0)return;const s=e.value.findIndex(c=>a.id==c.id);s!=-1&&(e.value[s].now=e.value[s].now-1,await u(e.value[s]))},o=async a=>{if(a.now>=T(a))return;const s=e.value.findIndex(c=>a.id==c.id);s!=-1&&(e.value[s].now=e.value[s].now+1,await u(e.value[s]))},u=async a=>{const s=(await f.post(`${g}/api/changeitem`,{data:a},{headers:{token:p().token}})).data;s.ok?n():v.error("修改参数失败: "+s.msg)};let r=d(!1),i=d("");return{loading:t,dataSource:e,getList:n,minus_one:l,add_one:o,changeItem:u,shownList:()=>r.value?e.value.filter(a=>a.title.includes(i.value)):e.value,onsearch:r,searchKey:i,searchChange:()=>{i.value.length==0?r.value=!1:r.value=!0}}}),M="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let b=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=M[n[t]&63];return e};const F=y("adder",()=>{let t=d(!1),e=d(""),n=d(!1),l=d(0),o=d(1),u=d(0),r=d(1);const i=()=>{e.value="",n.value=!1,l.value=0,o.value=1,u.value=0,r.value=1};return{add_title:e,add_onUpdate:n,add_now:l,add_episodes:o,add_weekday:u,add_updateTo:r,changeUpdate:()=>{l.value=0},judge:()=>n.value&&o.value>r.value?r.value:o.value,handleOk:async()=>{if(e.value.length==0){v.error("标题不能为空");return}const c=Date.now(),k={id:b(),title:e.value,episode:o.value,now:l.value,time:n.value?x(c,u.value,r.value):0},w=(await f.post(`${g}/api/addlist`,{data:k},{headers:{token:p().token}})).data;w.ok?(t.value=!1,v.success("添加成功"),E().getList(),i()):v.error("添加失败: "+w.msg)},addHandler:()=>{t.value=!0},showAdd:t,reset:i}});export{T as a,F as b,m as c,x as g,E as l};
