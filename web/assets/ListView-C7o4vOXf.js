import{d as z,r as y,m as A,a as q,b as G,c as J,o as Q,e as k,f as U,g as l,u as t,h as a,w as s,i as B,F as S,j as _,k as d,l as P,t as H,n as $,v as L,M as W}from"./index-8dv08548.js";import{t as M,H as X,v as Y,_ as Z}from"./token-B0fT7N9Y.js";import{c as V,a as D,l as w,g as h,b as i}from"./adder-MAPBoOvF.js";import{_ as c}from"./_plugin-vue_export-helper-BsQhiAd-.js";const o=z("edit",()=>{let C=y(!1),v=y(""),f=y(!1),p=y(1),u=y(1),e=y(1),x=y(0),I=y("");return{showEdit:C,edit_title:v,edit_onUpdate:f,edit_episodes:p,edit_now:u,edit_updateTo:e,edit_weekday:x,edit_id:I,judgeEdit:()=>f.value&&p.value>e.value?e.value:p.value,openEdit:m=>{v.value=m.title,p.value=m.episode,f.value=V(m.time)<m.episode,e.value=D(m),u.value=m.now,x.value=new Date(m.time).getDay(),I.value=m.id,C.value=!0},EditOk:async()=>{const m=Date.now();await w().changeItem({id:I.value,title:v.value,episode:p.value,now:u.value,time:f.value?h(m,x.value,e.value):0}),C.value=!1},changeUpdate:()=>{u.value=1}}}),b=z("addto",()=>{const C=x=>{p.value=x,v.value=!0};let v=y(!1),f=y(""),p=y("");return{onDialogCancel:()=>{v.value=!1,f.value="",p.value=""},addBangumiOk:async()=>{if(f.value.length==0){A.error("字幕组不能为空");return}else if(p.value.length==0){A.error("标题不能为空");return}const x=(await q.post(`${G}/api/dl/add`,{data:{title:p.value,ass:f.value}},{headers:{token:M().token}})).data;x.ok?(A.success("添加成功"),v.value=!1):A.error("添加失败: "+x.msg)},bangumiAddTitle:p,bangumiAddAss:f,addDownloader:C,showAddBangumiDialog:v}}),ee={key:0,class:"body"},te={class:"toolbar"},ne=["onClick"],le=["onClick"],ae=["onClick"],se=["onClick"],ie=["onClick"],oe={key:3,style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},de={key:4,style:{"user-select":"none"}},ue={key:5,style:{"user-select":"none"}},pe={class:"modalContent"},re={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},me={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},ve={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},ge={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},ye={class:"modalContent"},fe={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},ke={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},_e={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},xe={style:{"margin-top":"10px",display:"grid","align-items":"center","grid-template-columns":"70px auto"}},we={class:"bangumiItem",style:{"margin-top":"10px"}},be={class:"bangumiItem_content"},Ue={class:"bangumiItem",style:{"margin-top":"10px"}},Ce={class:"bangumiItem_content"},Ee=J({__name:"ListView",setup(C){document.title="AnimeHelper | 列表";const v=y(null);window.addEventListener("keydown",u=>{u.key=="/"&&(u.preventDefault(),v.value&&v.value.focus())});const f=u=>{W.confirm({title:"删除项",content:`你确定要删除:《${u.title}》吗`,centered:!0,async onOk(){const e=(await q.post(`${G}/api/dellist`,{id:u.id},{headers:{token:M().token}})).data;e.ok?(A.success("删除成功"),w().getList()):A.error("删除失败: "+e.msg)}})};Q(()=>{M().getToken(),w().getList()});const p=[{title:"标题",dataIndex:"title",key:"title",fixed:"left",width:150},{title:"状态",dataIndex:"status",key:"status",width:70,filters:[{text:"更新中",value:"onUpdate"},{text:"已完结",value:"finished"}],onFilter:(u,e)=>u=="onUpdate"?V(e.time)<e.episode:V(e.time)>=e.episode},{title:"集数",dataIndex:"episode",key:"episode",width:70},{title:"看至",dataIndex:"now",key:"now",width:70},{title:"进度",dataIndex:"progress",key:"progress",width:100,filters:[{text:"进行中",value:"onProgress"},{text:"已看完",value:"finished"}],onFilter:(u,e)=>u=="onProgress"?e.now/D(e)<1:e.now/D(e)>=1},{title:"操作",dataIndex:"op",key:"op",width:200}];return(u,e)=>{const x=_("a-button"),I=_("a-input-search"),N=_("a-progress"),j=_("a-tag"),R=_("a-table"),O=_("a-input"),m=_("a-checkbox"),E=_("a-input-number"),r=_("a-select-option"),K=_("a-select"),F=_("a-modal");return k(),U(S,null,[l(X),t(w)().loading?(k(),B(Z,{key:1})):(k(),U("div",ee,[a("div",te,[l(x,{type:"primary",style:{"margin-right":"30px"},onClick:t(i)().addHandler},{default:s(()=>e[18]||(e[18]=[d("添加")])),_:1},8,["onClick"]),l(I,{placeholder:t(Y)().isMobile?"搜索":"按下/可以聚焦到这里",value:t(w)().searchKey,"onUpdate:value":e[0]||(e[0]=n=>t(w)().searchKey=n),"enter-button":"",onChange:t(w)().searchChange,allowClear:!0,ref_key:"searchRef",ref:v},null,8,["placeholder","value","onChange"])]),l(R,{dataSource:t(w)().shownList(),columns:p,pagination:!1,size:"small",scroll:{x:500},sticky:""},{bodyCell:s(({column:n,record:g})=>[n.key==="progress"?(k(),B(N,{key:0,percent:g.now/t(D)(g)*100,showInfo:!1},null,8,["percent"])):n.key==="op"?(k(),U(S,{key:1},[a("a",{style:{"user-select":"none"},onClick:T=>t(o)().openEdit(g)},"编辑",8,ne),a("a",{style:{"margin-left":"10px","user-select":"none"},onClick:T=>t(b)().addDownloader(g.title)},"添加到...",8,le),a("a",{style:{"margin-left":"10px","user-select":"none"},onClick:T=>t(w)().minus_one(g)},e[19]||(e[19]=[a("i",{class:"bi bi-dash-circle-fill"},null,-1)]),8,ae),a("a",{style:{"margin-left":"10px","user-select":"none"},onClick:T=>t(w)().add_one(g)},e[20]||(e[20]=[a("i",{class:"bi bi-plus-circle-fill"},null,-1)]),8,se),a("a",{style:{"margin-left":"10px","user-select":"none"},onClick:T=>f(g)},e[21]||(e[21]=[a("i",{class:"bi bi-trash3-fill"},null,-1)]),8,ie)],64)):P("",!0),n.key==="status"?(k(),U(S,{key:2},[t(V)(g.time)<g.episode?(k(),B(j,{key:0,color:"green",style:{"user-select":"none"}},{default:s(()=>e[22]||(e[22]=[d("更新中")])),_:1})):(k(),B(j,{key:1,style:{"user-select":"none"}},{default:s(()=>e[23]||(e[23]=[d("已完结")])),_:1}))],64)):n.key==="title"?(k(),U("div",oe,H(g.title),1)):n.key==="episode"?(k(),U("div",de,H(t(D)(g)),1)):n.key==="now"?(k(),U("div",ue,H(g.now),1)):P("",!0)]),_:1},8,["dataSource"])])),l(F,{open:t(i)().showAdd,"onUpdate:open":e[7]||(e[7]=n=>t(i)().showAdd=n),title:"添加一个新的番剧",onOk:t(i)().handleOk,centered:""},{default:s(()=>[a("div",pe,[l(O,{placeholder:"番剧标题",value:t(i)().add_title,"onUpdate:value":e[1]||(e[1]=n=>t(i)().add_title=n)},null,8,["value"]),l(m,{style:{"margin-top":"10px"},checked:t(i)().add_onUpdate,"onUpdate:checked":e[2]||(e[2]=n=>t(i)().add_onUpdate=n),onChange:t(i)().changeUpdate},{default:s(()=>e[24]||(e[24]=[d("当前在更新")])),_:1},8,["checked","onChange"]),a("div",re,[e[25]||(e[25]=a("div",{style:{"margin-right":"10px"}},"集数",-1)),l(E,{value:t(i)().add_episodes,"onUpdate:value":e[3]||(e[3]=n=>t(i)().add_episodes=n),min:1},null,8,["value"])]),a("div",me,[e[26]||(e[26]=a("div",{style:{"margin-right":"10px"}},"观看至",-1)),l(E,{value:t(i)().add_now,"onUpdate:value":e[4]||(e[4]=n=>t(i)().add_now=n),min:0,max:t(i)().judge()},null,8,["value","max"])]),$(a("div",ve,[e[27]||(e[27]=a("div",{style:{"margin-right":"10px"}},"更新至",-1)),l(E,{value:t(i)().add_updateTo,"onUpdate:value":e[5]||(e[5]=n=>t(i)().add_updateTo=n),min:1,max:t(i)().add_episodes},null,8,["value","max"])],512),[[L,t(i)().add_onUpdate]]),$(a("div",ge,[e[35]||(e[35]=a("div",{style:{"margin-right":"10px"}},"更新日期",-1)),l(K,{value:t(i)().add_weekday,"onUpdate:value":e[6]||(e[6]=n=>t(i)().add_weekday=n)},{default:s(()=>[l(r,{value:0},{default:s(()=>e[28]||(e[28]=[d("星期日")])),_:1}),l(r,{value:1},{default:s(()=>e[29]||(e[29]=[d("星期一")])),_:1}),l(r,{value:2},{default:s(()=>e[30]||(e[30]=[d("星期二")])),_:1}),l(r,{value:3},{default:s(()=>e[31]||(e[31]=[d("星期三")])),_:1}),l(r,{value:4},{default:s(()=>e[32]||(e[32]=[d("星期四")])),_:1}),l(r,{value:5},{default:s(()=>e[33]||(e[33]=[d("星期五")])),_:1}),l(r,{value:6},{default:s(()=>e[34]||(e[34]=[d("星期六")])),_:1})]),_:1},8,["value"])],512),[[L,t(i)().add_onUpdate]])])]),_:1},8,["open","onOk"]),l(F,{open:t(o)().showEdit,"onUpdate:open":e[14]||(e[14]=n=>t(o)().showEdit=n),title:"编辑信息",onOk:t(o)().EditOk,centered:""},{default:s(()=>[a("div",ye,[l(O,{placeholder:"番剧标题",value:t(o)().edit_title,"onUpdate:value":e[8]||(e[8]=n=>t(o)().edit_title=n)},null,8,["value"]),l(m,{style:{"margin-top":"10px"},checked:t(o)().edit_onUpdate,"onUpdate:checked":e[9]||(e[9]=n=>t(o)().edit_onUpdate=n),onChange:t(o)().changeUpdate},{default:s(()=>e[36]||(e[36]=[d("当前在更新")])),_:1},8,["checked","onChange"]),a("div",fe,[e[37]||(e[37]=a("div",{style:{"margin-right":"10px"}},"集数",-1)),l(E,{value:t(o)().edit_episodes,"onUpdate:value":e[10]||(e[10]=n=>t(o)().edit_episodes=n),min:1},null,8,["value"])]),a("div",ke,[e[38]||(e[38]=a("div",{style:{"margin-right":"10px"}},"观看至",-1)),l(E,{value:t(o)().edit_now,"onUpdate:value":e[11]||(e[11]=n=>t(o)().edit_now=n),min:0,max:t(o)().judgeEdit()},null,8,["value","max"])]),$(a("div",_e,[e[39]||(e[39]=a("div",{style:{"margin-right":"10px"}},"更新至",-1)),l(E,{value:t(o)().edit_updateTo,"onUpdate:value":e[12]||(e[12]=n=>t(o)().edit_updateTo=n),min:1,max:t(o)().edit_episodes},null,8,["value","max"])],512),[[L,t(o)().edit_onUpdate]]),$(a("div",xe,[e[47]||(e[47]=a("div",{style:{"margin-right":"10px"}},"更新日期",-1)),l(K,{value:t(o)().edit_weekday,"onUpdate:value":e[13]||(e[13]=n=>t(o)().edit_weekday=n)},{default:s(()=>[l(r,{value:0},{default:s(()=>e[40]||(e[40]=[d("星期日")])),_:1}),l(r,{value:1},{default:s(()=>e[41]||(e[41]=[d("星期一")])),_:1}),l(r,{value:2},{default:s(()=>e[42]||(e[42]=[d("星期二")])),_:1}),l(r,{value:3},{default:s(()=>e[43]||(e[43]=[d("星期三")])),_:1}),l(r,{value:4},{default:s(()=>e[44]||(e[44]=[d("星期四")])),_:1}),l(r,{value:5},{default:s(()=>e[45]||(e[45]=[d("星期五")])),_:1}),l(r,{value:6},{default:s(()=>e[46]||(e[46]=[d("星期六")])),_:1})]),_:1},8,["value"])],512),[[L,t(o)().edit_onUpdate]])])]),_:1},8,["open","onOk"]),l(F,{open:t(b)().showAddBangumiDialog,"onUpdate:open":e[17]||(e[17]=n=>t(b)().showAddBangumiDialog=n),title:"添加一个番剧",onOk:t(b)().addBangumiOk,onCancel:t(b)().onDialogCancel,centered:""},{default:s(()=>[a("div",we,[e[48]||(e[48]=a("div",{class:"bangumiItem_title"},"字幕组",-1)),a("div",be,[l(O,{value:t(b)().bangumiAddAss,"onUpdate:value":e[15]||(e[15]=n=>t(b)().bangumiAddAss=n)},null,8,["value"])])]),a("div",Ue,[e[49]||(e[49]=a("div",{class:"bangumiItem_title"},"标题",-1)),a("div",Ce,[l(O,{value:t(b)().bangumiAddTitle,"onUpdate:value":e[16]||(e[16]=n=>t(b)().bangumiAddTitle=n)},null,8,["value"])])])]),_:1},8,["open","onOk","onCancel"])],64)}}}),Te=c(Ee,[["__scopeId","data-v-6608afb5"]]);export{Te as default};
