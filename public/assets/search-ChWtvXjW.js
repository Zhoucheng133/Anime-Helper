import{d as H,e as n,C as z,u as R,c as _,h as a,i as s,w as o,g as t,p as V,j as d,b as k,t as g,v as T,x as Y,y as x,o as v,_ as j}from"./index-c7rHhO_G.js";import{d as B}from"./dayjs.min-2rai63wT.js";import{s as D,_ as K,a as N,r as A}from"./copy.vue_vue_type_script_setup_true_lang-Bo33pvg0.js";import{_ as M}from"./loading.vue_vue_type_script_setup_true_lang-CSWb94bZ.js";import{s as q,b as $,c as E}from"./downloader-CCZPzk0B.js";import{s as I}from"./index-qWPfprEv.js";import{s as S}from"./index-BXG5dCoD.js";import"./index.browser-CVe5_-_l.js";const U={class:"page"},F={class:"topbar"},G={key:0},J={class:"title_area"},L={class:"title"},O={class:"flex"},Q={class:"select-none text-gray-400 text-xs"},W={key:1,class:"empty"},X={class:"add_tip"},Z=H({__name:"search",setup(P){const u=n(),h=z(),y=n(),w=R();document.title="AnimeHelper | 搜索";const c=n(""),f=n([]),m=async(i=!1)=>{u.value.loadingHandler(!0,"搜索关键词...");const{data:e}=await T.get(`${Y}/api/search/${c.value}`,{headers:{token:x().token}});if(e.ok)f.value=e.msg;else if(e.msg=="令牌已过期"){if(!i&&await x().refreshToken()){m(!0);return}}else w.add({severity:"error",summary:"搜索失败",detail:e.msg,life:3e3});u.value.loadingHandler(!1,"获取最近更新列表")},C=(i,e)=>{h.require({target:i.currentTarget,message:"你确定要下载它吗",rejectProps:{label:"取消",severity:"secondary",outlined:!0,size:"small"},acceptProps:{size:"small",label:"下载"},accept:()=>A().download(e)})},r=n(),b=i=>{r.value.visible=!0,r.value.url=i.url,r.value.magnet=i.magnet};return(i,e)=>(v(),_("div",U,[a("div",F,[s(t(D),null,{default:o(()=>[s(t(S),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),fluid:!0,placeholder:"在这里搜索关键字",onKeydown:e[1]||(e[1]=V(()=>m(),["enter"]))},null,8,["modelValue"]),s(t(d),{onClick:e[2]||(e[2]=()=>m())},{default:o(()=>e[3]||(e[3]=[k("搜索")])),_:1})]),_:1})]),f.value.length!=0?(v(),_("div",G,[s(t(q),{value:f.value},{default:o(()=>[s(t($),{field:"title",header:"标题"},{body:o(l=>[a("div",J,[a("div",L,g(l.data.title),1),a("div",O,[a("div",Q,g(t(B)(l.data.time).format("YYYY-MM-DD HH:mm")),1)])])]),_:1}),s(t($),{header:"操作",style:{"min-width":"150px"}},{body:o(l=>[s(t(E),null,{default:o(()=>[s(t(d),{severity:"secondary",icon:"pi pi-link",size:"small",style:{"font-size":"12px"},onClick:p=>b(l.data)},null,8,["onClick"]),s(t(d),{severity:"secondary",label:"添加至",size:"small",style:{"font-size":"12px"},onClick:p=>y.value.showAddHandler(l.data.title)},null,8,["onClick"]),s(t(d),{severity:"secondary",size:"small",onClick:p=>C(p,l.data.url)},{default:o(()=>e[4]||(e[4]=[a("i",{class:"pi pi-download",style:{"font-size":"12px"}},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["value"])])):(v(),_("div",W,[a("div",X,[e[6]||(e[6]=a("div",null,"输入搜索关键词然后点击",-1)),s(t(I),null,{default:o(()=>e[5]||(e[5]=[k("搜索")])),_:1}),e[7]||(e[7]=a("div",null,"按钮",-1))])])),s(M,{ref_key:"loadingRef",ref:u},null,512),s(K,{ref_key:"addRef",ref:y},null,512),s(N,{ref_key:"copyRef",ref:r},null,512)]))}}),re=j(Z,[["__scopeId","data-v-da894871"]]);export{re as default};
