import{l as _}from"./list-BgbmyI2J.js";import{s as h,a as F,b as S}from"./index.browser-BoQ3C5X-.js";import{d as H,e as d,f as $,w as g,g as l,h as t,o as p,z as D,u as B,v as N,x as R,y as z,c as y,F as T,i as m,a as I,j as A,k as E,A as L,b as M,t as q,n as G,_ as J}from"./index-CJyZbcah.js";import{s as V}from"./index-CKVOLLG-.js";import{s as K,a as O,b as P,c as Q}from"./index-DvdPXNTy.js";import{s as X}from"./index-nX_9UKc3.js";const Y=H({__name:"loading",setup(b,{expose:v}){const i=d(!1),f=d("");return v({loadingHandler:(n,r)=>{f.value=r,i.value=n}}),(n,r)=>(p(),$(l(h),{visible:i.value,"onUpdate:visible":r[0]||(r[0]=a=>i.value=a),modal:"",header:f.value,style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1,s:""},{default:g(()=>r[1]||(r[1]=[t("div",null,"正在加载中...",-1)])),_:1},8,["visible","header"]))}}),C=D("calendar",()=>{const b=d(),v=B(),i=async(f=!1)=>{const{data:o}=await N.get(`${R}/api/calendar/get`,{headers:{token:z().token}});if(o.ok)b.value=o.msg;else if(o.msg=="令牌已过期"){if(!f&&await z().refreshToken()){i(!0);return}}else v.add({severity:"error",summary:"请求失败",detail:o.msg,life:3e3})};return{list:b,getList:i}}),Z={class:"flex items-center gap-2 mb-4"},ee={class:"flex items-center gap-2 mb-4"},le={class:"flex items-center gap-2 mb-4"},ae={class:"flex items-center gap-2 mb-4"},se={key:0,class:"flex items-center gap-2 mb-4"},te={key:1,class:"flex items-center gap-2 mb-4"},oe={class:"flex justify-end gap-2"},ne=H({__name:"add",setup(b,{expose:v}){const i=d(),f=d(!1),o=d(_().weekdays[0]),n=B(),r=d(""),a=d(!0),u=d(""),k=d("0"),c=d(""),W=d(""),U=async(w,e,s=!1)=>{i.value.loadingHandler(!0,"加载番剧信息"),W.value=w.id,f.value=!0,r.value=w.title,o.value=_().weekdays[e==0?6:e-1];const{data:x}=await N.get(`${R}/api/calendar/info/${w.id}`,{headers:{token:z().token}});if(x.ok)u.value=x.msg.eps,c.value=x.msg.updates;else if(x.msg=="令牌已过期"){if(!s&&await z().refreshToken()){U(w,e,!0);return}}else n.add({severity:"error",summary:"获取信息失败",detail:x.msg,life:3e3});i.value.loadingHandler(!1,"加载番剧信息")},j=async()=>{if(r.value.length==0){n.add({severity:"error",summary:"添加失败",detail:"标题不能为空",life:3e3});return}else if(u.value.length==0){n.add({severity:"error",summary:"添加失败",detail:"集数不能为空",life:3e3});return}else if(k.value.length==0){n.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(c.value.length==0&&a.value){n.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(a.value&&parseInt(c.value)==0){n.add({severity:"error",summary:"添加失败",detail:"更新集数不能为0",life:3e3});return}_().addItem(r.value,a.value,parseInt(u.value),parseInt(k.value),parseInt(c.value),o.value.code),C().getList(),f.value=!1};return v({showAddHandler:U}),(w,e)=>(p(),y(T,null,[m(l(h),{visible:f.value,"onUpdate:visible":e[7]||(e[7]=s=>f.value=s),modal:"",header:"添加到列表...",style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1},{default:g(()=>[t("div",Z,[m(l(F),{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),inputId:"update",binary:""},null,8,["modelValue"]),e[8]||(e[8]=t("label",{for:"update"}," 当前在更新 ",-1))]),t("div",ee,[e[9]||(e[9]=t("label",{for:"title",class:"font-semibold w-20"},"标题",-1)),m(l(V),{size:"small",id:"title",class:"flex-auto",autocomplete:"off",modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s)},null,8,["modelValue"])]),t("div",le,[e[10]||(e[10]=t("label",{for:"episode",class:"font-semibold w-20"},"集数",-1)),m(l(V),{type:"number",size:"small",id:"episode",class:"flex-auto",autocomplete:"off",modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),min:"1"},null,8,["modelValue"])]),t("div",ae,[e[11]||(e[11]=t("label",{for:"watchTo",class:"font-semibold w-20"},"观看至",-1)),m(l(V),{type:"number",size:"small",id:"watchTo",class:"flex-auto",autocomplete:"off",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),min:"0",max:a.value?c.value:u.value},null,8,["modelValue","max"])]),a.value?(p(),y("div",se,[e[12]||(e[12]=t("label",{for:"updateTo",class:"font-semibold w-20"},"更新至",-1)),m(l(V),{type:"number",size:"small",id:"updateTo",class:"flex-auto",autocomplete:"off",modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=s=>c.value=s),min:"1",max:u.value},null,8,["modelValue","max"])])):I("",!0),a.value?(p(),y("div",te,[e[13]||(e[13]=t("label",{for:"updateWeek",class:"font-semibold w-20"},"更新周",-1)),m(l(S),{size:"small",id:"updateWeek",modelValue:o.value,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value=s),options:l(_)().weekdays,"scroll-height":"20rem",optionLabel:"name"},null,8,["modelValue","options"])])):I("",!0),t("div",oe,[m(l(A),{type:"button",label:"取消",severity:"secondary",onClick:e[6]||(e[6]=s=>f.value=!1),size:"small"}),m(l(A),{type:"button",label:"添加",onClick:j,size:"small"})])]),_:1},8,["visible"]),m(Y,{ref_key:"loadingRef",ref:i},null,512)],64))}}),re={class:"page"},de={key:0,class:"empty"},ie=H({__name:"calendar",setup(b){document.title="AnimeHelper | 每日放送";const v=d(!0),i=d(),f=(o,n)=>{o.added||i.value.showAddHandler(o,n)};return E(async()=>{await C().getList(),v.value=!1}),(o,n)=>(p(),y("div",re,[v.value?(p(),y("div",de,n[0]||(n[0]=[t("div",{class:"add_tip"},[t("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"20px"}}),t("div",{style:{"margin-left":"10px"}},"正在加载中...")],-1)]))):(p(),$(l(K),{key:1,multiple:!0,value:[0,1,2,3,4,5,6]},{default:g(()=>[(p(!0),y(T,null,L(l(C)().list,(r,a)=>(p(),$(l(O),{key:a,value:a},{default:g(()=>[m(l(P),null,{default:g(()=>[M(q(l(_)().weekdays[a==0?6:a-1].name),1)]),_:2},1024),m(l(Q),null,{default:g(()=>[(p(!0),y(T,null,L(r,(u,k)=>(p(),$(l(X),{rounded:"",key:u.id,value:u.title,class:G(u.added?"select-none m-1":"select-none m-1 cursor-pointer"),severity:u.added?"warn":"secondary",onClick:c=>f(u,a)},null,8,["value","class","severity","onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})),m(ne,{ref_key:"addRef",ref:i},null,512)]))}}),ye=J(ie,[["__scopeId","data-v-99d8db6f"]]);export{ye as default};
