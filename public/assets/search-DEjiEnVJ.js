import{d as z,E as H,e as n,u as V,c as d,i as t,j as s,w as i,g as a,l as E,k as u,b as k,t as g,n as T,p as R,q as x,o as c,_ as Y}from"./index-DIiYULlP.js";import{d as j}from"./dayjs.min-2rai63wT.js";import{s as B,_ as D,a as K,r as M}from"./copy.vue_vue_type_script_setup_true_lang-DkAQ3C70.js";import{s as N,a as $,c as q}from"./downloader-Bj4pWVS8.js";import{s as A}from"./index-D5b_h-jZ.js";import{s as I}from"./index-Bdj7Y4dL.js";import"./index.browser-BOSKGvW6.js";const L={class:"page"},S={class:"topbar"},U={key:0,class:"empty"},F={key:1},G={class:"title_area"},J={class:"title"},O={class:"flex"},Q={class:"select-none text-gray-400 text-xs"},W={key:2,class:"empty"},X={class:"add_tip"},Z=z({__name:"search",setup(P){const w=H(),_=n(),b=V();document.title="AnimeHelper | 搜索";const p=n(!1),m=n(""),f=n([]),v=async(o=!1)=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),p.value=!0;const{data:e}=await T.get(`${R}/api/search/${m.value}`,{headers:{token:x().token}});if(e.ok)f.value=e.msg;else if(e.msg=="令牌已过期"){if(!o&&await x().refreshToken()){v(!0);return}}else b.add({severity:"error",summary:"搜索失败",detail:e.msg,life:3e3});p.value=!1},C=(o,e)=>{w.require({target:o.currentTarget,message:"你确定要下载它吗",rejectProps:{label:"取消",severity:"secondary",outlined:!0,size:"small"},acceptProps:{size:"small",label:"下载"},accept:()=>M().download(e)})},r=n(),h=o=>{r.value.visible=!0,r.value.url=o.url,r.value.magnet=o.magnet};return(o,e)=>(c(),d("div",L,[t("div",S,[s(a(B),null,{default:i(()=>[s(a(I),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),fluid:!0,placeholder:"在这里搜索关键字",onKeydown:e[1]||(e[1]=E(()=>v(),["enter"]))},null,8,["modelValue"]),s(a(u),{onClick:e[2]||(e[2]=()=>v())},{default:i(()=>e[3]||(e[3]=[k("搜索")])),_:1})]),_:1})]),p.value?(c(),d("div",U,e[4]||(e[4]=[t("div",{class:"add_tip"},[t("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"20px"}}),t("div",{style:{"margin-left":"10px"}},"正在搜索中...")],-1)]))):f.value.length!=0?(c(),d("div",F,[s(a(N),{value:f.value},{default:i(()=>[s(a($),{field:"title",header:"标题"},{body:i(l=>[t("div",G,[t("div",J,g(l.data.title),1),t("div",O,[t("div",Q,g(a(j)(l.data.time).format("YYYY-MM-DD HH:mm")),1)])])]),_:1}),s(a($),{header:"操作",style:{"min-width":"150px"}},{body:i(l=>[s(a(q),null,{default:i(()=>[s(a(u),{severity:"secondary",icon:"pi pi-link",size:"small",style:{"font-size":"12px"},onClick:y=>h(l.data)},null,8,["onClick"]),s(a(u),{severity:"secondary",label:"添加至",size:"small",style:{"font-size":"12px"},onClick:y=>_.value.showAddHandler(l.data.title)},null,8,["onClick"]),s(a(u),{severity:"secondary",size:"small",onClick:y=>C(y,l.data.url)},{default:i(()=>e[5]||(e[5]=[t("i",{class:"pi pi-download",style:{"font-size":"12px"}},null,-1)])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["value"])])):(c(),d("div",W,[t("div",X,[e[7]||(e[7]=t("div",null,"输入搜索关键词然后点击",-1)),s(a(A),null,{default:i(()=>e[6]||(e[6]=[k("搜索")])),_:1}),e[8]||(e[8]=t("div",null,"按钮",-1))])])),s(D,{ref_key:"addRef",ref:_},null,512),s(K,{ref_key:"copyRef",ref:r},null,512)]))}}),ne=Y(Z,[["__scopeId","data-v-26f622b7"]]);export{ne as default};
