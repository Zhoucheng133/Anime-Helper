import{y as Y,u as K,C as N,e as s,D as O,q as d,v as c,x as l}from"./index-Dlzrg73N.js";import{n as R}from"./index.browser-CRTWgEnj.js";const G=Y("list",()=>{const u=K(),F=N();function I(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function w(e,t,a){const o=I(new Date(e)),r=(a-1)*7,m=(o.getDay()-t+7)%7,f=r+m;return new Date(o.getTime()-f*24*60*60*1e3).getTime()}function y(e){const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-e,r=Math.floor(o/(1e3*60*60*24)),i=Math.floor(r/7);return Math.max(i,0)+1}const v=s([{name:"所有",code:"none"},{name:"进行中",code:"progress"},{name:"更新中",code:"onUpdate"},{name:"已完结",code:"updateDone"},{name:"已看完",code:"watchDone"},{name:"搜索",code:"search"},{name:"更新周",code:"weekday"}]),g=s(v.value[1]),k=s([{name:"星期一",code:1},{name:"星期二",code:2},{name:"星期三",code:3},{name:"星期四",code:4},{name:"星期五",code:5},{name:"星期六",code:6},{name:"星期日",code:0}]),j=new Date().getDay(),T=s(k.value.find(e=>e.code===(j||0))??k.value[0]),$=s(0),D=s(""),E=s(0),x=s(20),M=s([]);async function n(){const{data:e}=await d.get(`${c}/api/list/get`,{params:{offset:E.value,limit:x.value,filter:g.value.code,param:g.value.code=="weekday"?T.value.code:D.value},headers:{token:l().token}});e.ok&&(M.value=e.msg.data,$.value=e.msg.length)}function b(e){return e==0?"/":new Date(e).toLocaleString("zh-CN",{weekday:"long"})}function z(e){return e.time==0?!1:y(e.time)<e.episode}function h(e){return e.time==0||y(e.time)>e.episode?e.episode:y(e.time)}function C(e){return e.now/h(e)*100}O(D,()=>{g.value.code=="search"&&n()});async function S(e){if(e.now>=h(e))return;const{data:t}=await d.post(`${c}/api/list/edit`,{data:{...e,now:e.now+=1}},{headers:{token:l().token}});t.ok?n():u.add({severity:"error",summary:"更新失败",detail:t.msg,life:3e3})}async function W(e){if(e.now<=0)return;const{data:t}=await d.post(`${c}/api/list/edit`,{data:{...e,now:e.now-=1}},{headers:{token:l().token}});t.ok?n():u.add({severity:"error",summary:"更新失败",detail:t.msg,life:3e3})}async function q(e,t,a,o,r,i){const m=Date.now(),f={id:R(),title:e,episode:a,now:o,time:t?w(m,i,r):0},{data:p}=await d.post(`${c}/api/list/add`,{data:f},{headers:{token:l().token}});p.ok?n():u.add({severity:"error",summary:"添加失败",detail:p.msg,life:3e3})}async function L(e,t,a,o,r,i,m){const f=Date.now(),p={id:e,title:t,episode:o,now:r,time:a?w(f,m,i):0},{data:P}=await d.post(`${c}/api/list/edit`,{data:p},{headers:{token:l().token}});P.ok?n():u.add({severity:"error",summary:"更新失败",detail:P.msg,life:3e3})}function U(e,t){F.require({target:e.currentTarget,position:"bottomleft",message:"你确定要删除这项吗",rejectProps:{label:"取消",severity:"secondary",outlined:!0,size:"small"},acceptProps:{label:"删除",severity:"danger",size:"small"},accept:async()=>{const{data:a}=await d.delete(`${c}/api/list/del/${t.id}`,{headers:{token:l().token}});a.ok?n():u.add({severity:"error",summary:"删除失败",detail:a.msg,life:3e3})},reject:()=>{}})}return{deleteItem:U,editItem:L,addItem:q,getTimestampOfFirstEpisode:w,add:S,minus:W,searchKeyWord:D,calProgress:C,analyseEpisode:h,calculateEpisodesReleased:y,offset:E,getWeekday:b,onUpudate:z,selectedFilter:g,filters:v,selectedWeekday:T,weekdays:k,length:$,list:M,getList:n}});export{G as l};
