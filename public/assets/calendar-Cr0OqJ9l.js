import{l as w}from"./list-BM_rTy3X.js";import{_ as j}from"./loading.vue_vue_type_script_setup_true_lang-B2aq3bC0.js";import{z as F,e as u,u as L,v as h,x as B,y as _,d as N,c as y,F as T,i as t,g as a,w as V,h as d,a as U,j as A,o as p,k as S,A as H,f as I,b as D,t as E,n as M}from"./index-YslYnHGW.js";import{s as q,a as G,b as J}from"./index.browser-pToC0Rvn.js";import{s as $}from"./index-CAYSxIQR.js";import{s as K,a as O,b as P,c as Q}from"./index-DtFYIO9n.js";import{s as X}from"./index-5VA2hjD3.js";const z=F("calendar",()=>{const x=u(),c=L(),i=async(r=!1)=>{const{data:o}=await h.get(`${B}/api/calendar/get`,{headers:{token:_().token}});if(o.ok)x.value=o.msg;else if(o.msg=="令牌已过期"){if(!r&&await _().refreshToken()){i(!0);return}}else c.add({severity:"error",summary:"请求失败",detail:o.msg,life:3e3})};return{list:x,getList:i}}),Y={class:"flex items-center gap-2 mb-4"},Z={class:"flex items-center gap-2 mb-4"},ee={class:"flex items-center gap-2 mb-4"},ae={class:"flex items-center gap-2 mb-4"},le={key:0,class:"flex items-center gap-2 mb-4"},se={key:1,class:"flex items-center gap-2 mb-4"},te={class:"flex justify-end gap-2"},oe=N({__name:"add",setup(x,{expose:c}){const i=u(),r=u(!1),o=u(w().weekdays[0]),m=L(),n=u(""),s=u(!0),f=u(""),g=u("0"),v=u(""),R=u(""),C=async(b,e,l=!1)=>{i.value.loadingHandler(!0,"加载番剧信息"),R.value=b.id,r.value=!0,n.value=b.title,o.value=w().weekdays[e==0?6:e-1];const{data:k}=await h.get(`${B}/api/calendar/info/${b.id}`,{headers:{token:_().token}});if(k.ok)f.value=k.msg.eps,v.value=k.msg.updates;else if(k.msg=="令牌已过期"){if(!l&&await _().refreshToken()){C(b,e,!0);return}}else m.add({severity:"error",summary:"获取信息失败",detail:k.msg,life:3e3});i.value.loadingHandler(!1,"加载番剧信息")},W=async()=>{if(n.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"标题不能为空",life:3e3});return}else if(f.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"集数不能为空",life:3e3});return}else if(g.value.length==0){m.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(v.value.length==0&&s.value){m.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(s.value&&parseInt(v.value)==0){m.add({severity:"error",summary:"添加失败",detail:"更新集数不能为0",life:3e3});return}w().addItem(n.value,s.value,parseInt(f.value),parseInt(g.value),parseInt(v.value),o.value.code),z().getList(),r.value=!1};return c({showAddHandler:C}),(b,e)=>(p(),y(T,null,[t(a(q),{visible:r.value,"onUpdate:visible":e[7]||(e[7]=l=>r.value=l),modal:"",header:"添加到列表...",style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1},{default:V(()=>[d("div",Y,[t(a(G),{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),inputId:"update",binary:""},null,8,["modelValue"]),e[8]||(e[8]=d("label",{for:"update"}," 当前在更新 ",-1))]),d("div",Z,[e[9]||(e[9]=d("label",{for:"title",class:"font-semibold w-20"},"标题",-1)),t(a($),{size:"small",id:"title",class:"flex-auto",autocomplete:"off",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l)},null,8,["modelValue"])]),d("div",ee,[e[10]||(e[10]=d("label",{for:"episode",class:"font-semibold w-20"},"集数",-1)),t(a($),{type:"number",size:"small",id:"episode",class:"flex-auto",autocomplete:"off",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),min:"1"},null,8,["modelValue"])]),d("div",ae,[e[11]||(e[11]=d("label",{for:"watchTo",class:"font-semibold w-20"},"观看至",-1)),t(a($),{type:"number",size:"small",id:"watchTo",class:"flex-auto",autocomplete:"off",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),min:"0",max:s.value?v.value:f.value},null,8,["modelValue","max"])]),s.value?(p(),y("div",le,[e[12]||(e[12]=d("label",{for:"updateTo",class:"font-semibold w-20"},"更新至",-1)),t(a($),{type:"number",size:"small",id:"updateTo",class:"flex-auto",autocomplete:"off",modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),min:"1",max:f.value},null,8,["modelValue","max"])])):U("",!0),s.value?(p(),y("div",se,[e[13]||(e[13]=d("label",{for:"updateWeek",class:"font-semibold w-20"},"更新周",-1)),t(a(J),{size:"small",id:"updateWeek",modelValue:o.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l),options:a(w)().weekdays,"scroll-height":"20rem",optionLabel:"name"},null,8,["modelValue","options"])])):U("",!0),d("div",te,[t(a(A),{type:"button",label:"取消",severity:"secondary",onClick:e[6]||(e[6]=l=>r.value=!1),size:"small"}),t(a(A),{type:"button",label:"添加",onClick:W,size:"small"})])]),_:1},8,["visible"]),t(j,{ref_key:"loadingRef",ref:i},null,512)],64))}}),re={class:"page"},ve=N({__name:"calendar",setup(x){document.title="AnimeHelper | 每日放送";const c=u(),i=(r,o)=>{r.added||c.value.showAddHandler(r,o)};return S(async()=>{await z().getList()}),(r,o)=>(p(),y("div",re,[t(a(K),{multiple:!0,value:[0,1,2,3,4,5,6]},{default:V(()=>[(p(!0),y(T,null,H(a(z)().list,(m,n)=>(p(),I(a(O),{key:n,value:n},{default:V(()=>[t(a(P),null,{default:V(()=>[D(E(a(w)().weekdays[n==0?6:n-1].name),1)]),_:2},1024),t(a(Q),null,{default:V(()=>[(p(!0),y(T,null,H(m,(s,f)=>(p(),I(a(X),{rounded:"",key:s.id,value:s.title,class:M(s.added?"select-none m-1":"select-none m-1 cursor-pointer"),severity:s.added?"warn":"secondary",onClick:g=>i(s,n)},null,8,["value","class","severity","onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),t(oe,{ref_key:"addRef",ref:c},null,512)]))}});export{ve as default};
