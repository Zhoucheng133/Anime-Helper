import{l as b}from"./list-BYyQtDqg.js";import{_ as U}from"./loading.vue_vue_type_script_setup_true_lang-Dy0z9eS6.js";import{y as j,e as d,u as A,q as I,v as L,x as R,d as B,c as y,F as $,i as s,g as a,w as k,h as r,a as z,j as C,o as p,z as F,A as H,f as T,b as S,t as q,n as D}from"./index-Dlzrg73N.js";import{s as E,a as M,b as G}from"./index.browser-CRTWgEnj.js";import{s as x}from"./index-Ct2rUClv.js";import{s as J,a as K,b as O,c as P,d as Q}from"./index-DVECBSfG.js";const _=j("calendar",()=>{const w=d(),c=A();return{list:w,getList:async()=>{const{data:n}=await I.get(`${L}/api/calendar/get`,{headers:{token:R().token}});n.ok?w.value=n.msg:c.add({severity:"error",summary:"请求失败",detail:n.msg,life:3e3})}}}),X={class:"flex items-center gap-2 mb-4"},Y={class:"flex items-center gap-2 mb-4"},Z={class:"flex items-center gap-2 mb-4"},ee={class:"flex items-center gap-2 mb-4"},le={key:0,class:"flex items-center gap-2 mb-4"},ae={key:1,class:"flex items-center gap-2 mb-4"},se={class:"flex justify-end gap-2"},te=B({__name:"add",setup(w,{expose:c}){const i=d(),n=d(!1),m=d(b().weekdays[0]),u=A(),v=d(""),t=d(!0),o=d(""),g=d("0"),f=d(""),N=d(""),W=async(V,e)=>{i.value.loadingHandler(!0,"加载番剧信息"),N.value=V.id,n.value=!0,v.value=V.title,m.value=b().weekdays[e==0?6:e-1];const{data:l}=await I.get(`${L}/api/calendar/info/${V.id}`,{headers:{token:R().token}});l.ok?(o.value=l.msg.eps,f.value=l.msg.updates):u.add({severity:"error",summary:"获取信息失败",detail:l.msg,life:3e3}),i.value.loadingHandler(!1,"加载番剧信息")},h=async()=>{if(v.value.length==0){u.add({severity:"error",summary:"添加失败",detail:"标题不能为空",life:3e3});return}else if(o.value.length==0){u.add({severity:"error",summary:"添加失败",detail:"集数不能为空",life:3e3});return}else if(g.value.length==0){u.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(f.value.length==0&&t.value){u.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(t.value&&parseInt(f.value)==0){u.add({severity:"error",summary:"添加失败",detail:"更新集数不能为0",life:3e3});return}b().addItem(v.value,t.value,parseInt(o.value),parseInt(g.value),parseInt(f.value),m.value.code),_().getList(),n.value=!1};return c({showAddHandler:W}),(V,e)=>(p(),y($,null,[s(a(E),{visible:n.value,"onUpdate:visible":e[7]||(e[7]=l=>n.value=l),modal:"",header:"添加到列表...",style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1},{default:k(()=>[r("div",X,[s(a(M),{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value=l),inputId:"update",binary:""},null,8,["modelValue"]),e[8]||(e[8]=r("label",{for:"update"}," 当前在更新 ",-1))]),r("div",Y,[e[9]||(e[9]=r("label",{for:"title",class:"font-semibold w-20"},"标题",-1)),s(a(x),{size:"small",id:"title",class:"flex-auto",autocomplete:"off",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l)},null,8,["modelValue"])]),r("div",Z,[e[10]||(e[10]=r("label",{for:"episode",class:"font-semibold w-20"},"集数",-1)),s(a(x),{type:"number",size:"small",id:"episode",class:"flex-auto",autocomplete:"off",modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value=l),min:"1"},null,8,["modelValue"])]),r("div",ee,[e[11]||(e[11]=r("label",{for:"watchTo",class:"font-semibold w-20"},"观看至",-1)),s(a(x),{type:"number",size:"small",id:"watchTo",class:"flex-auto",autocomplete:"off",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),min:"0",max:t.value?f.value:o.value},null,8,["modelValue","max"])]),t.value?(p(),y("div",le,[e[12]||(e[12]=r("label",{for:"updateTo",class:"font-semibold w-20"},"更新至",-1)),s(a(x),{type:"number",size:"small",id:"updateTo",class:"flex-auto",autocomplete:"off",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),min:"1",max:o.value},null,8,["modelValue","max"])])):z("",!0),t.value?(p(),y("div",ae,[e[13]||(e[13]=r("label",{for:"updateWeek",class:"font-semibold w-20"},"更新周",-1)),s(a(G),{size:"small",id:"updateWeek",modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value=l),options:a(b)().weekdays,"scroll-height":"20rem",optionLabel:"name"},null,8,["modelValue","options"])])):z("",!0),r("div",se,[s(a(C),{type:"button",label:"取消",severity:"secondary",onClick:e[6]||(e[6]=l=>n.value=!1),size:"small"}),s(a(C),{type:"button",label:"添加",onClick:h,size:"small"})])]),_:1},8,["visible"]),s(U,{ref_key:"loadingRef",ref:i},null,512)],64))}}),oe={class:"page"},fe=B({__name:"calendar",setup(w){document.title="AnimeHelper | 每日放送";const c=d(),i=d(),n=(m,u)=>{m.added||c.value.showAddHandler(m,u)};return F(async()=>{i.value.loadingHandler(!0,"获取每日放送列表"),await _().getList(),i.value.loadingHandler(!1,"获取每日放送列表")}),(m,u)=>(p(),y("div",oe,[s(a(J),{multiple:!0,value:[0,1,2,3,4,5,6]},{default:k(()=>[(p(!0),y($,null,H(a(_)().list,(v,t)=>(p(),T(a(K),{key:t,value:t},{default:k(()=>[s(a(O),null,{default:k(()=>[S(q(a(b)().weekdays[t==0?6:t-1].name),1)]),_:2},1024),s(a(P),null,{default:k(()=>[(p(!0),y($,null,H(v,(o,g)=>(p(),T(a(Q),{rounded:"",key:o.id,value:o.title,class:D(o.added?"select-none m-1":"select-none m-1 cursor-pointer"),severity:o.added?"warn":"secondary",onClick:f=>n(o,t)},null,8,["value","class","severity","onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),s(te,{ref_key:"addRef",ref:c},null,512),s(U,{ref_key:"loadingRef",ref:i},null,512)]))}});export{fe as default};
