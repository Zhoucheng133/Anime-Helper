import{l as c}from"./list-9ytKamNf.js";import{s as I,a as F,b as S}from"./index.browser-BFOnekc9.js";import{d as H,e as d,f as z,w as y,g as l,h as u,o as f,z as D,u as B,v as N,x as R,y as T,c as b,F as C,i as n,a as L,j as h,k as E,A,b as M,t as q,n as G}from"./index-Cm-C714L.js";import{s as $}from"./index-6LqCPvQY.js";import{s as J,a as K,b as O,c as P}from"./index-D_beJk3D.js";import{s as Q}from"./index-DG5avnYn.js";const X=H({__name:"loading",setup(k,{expose:p}){const m=d(!1),r=d("");return p({loadingHandler:(a,s)=>{r.value=s,m.value=a}}),(a,s)=>(f(),z(l(I),{visible:m.value,"onUpdate:visible":s[0]||(s[0]=t=>m.value=t),modal:"",header:r.value,style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1,s:""},{default:y(()=>s[1]||(s[1]=[u("div",null,"正在加载中...",-1)])),_:1},8,["visible","header"]))}}),_=D("calendar",()=>{const k=d(),p=B(),m=i=>c().list.some(a=>a.title==i),r=async(i=!1)=>{const{data:a}=await N.get(`${R}/api/calendar/get`,{headers:{token:T().token}});if(a.ok)k.value=a.msg;else if(a.msg=="令牌已过期"){if(!i&&await T().refreshToken()){r(!0);return}}else p.add({severity:"error",summary:"请求失败",detail:a.msg,life:3e3})};return{list:k,getList:r,added:m}}),Y={class:"flex items-center gap-2 mb-4"},Z={class:"flex items-center gap-2 mb-4"},ee={class:"flex items-center gap-2 mb-4"},le={class:"flex items-center gap-2 mb-4"},ae={key:0,class:"flex items-center gap-2 mb-4"},se={key:1,class:"flex items-center gap-2 mb-4"},te={class:"flex justify-end gap-2"},oe=H({__name:"add",setup(k,{expose:p}){const m=d(),r=d(!1),i=d(c().weekdays[0]),a=B(),s=d(""),t=d(!0),v=d(""),w=d("0"),g=d(""),W=d(""),U=async(V,e,o=!1)=>{m.value.loadingHandler(!0,"加载番剧信息"),W.value=V.id,r.value=!0,s.value=V.title,i.value=c().weekdays[e==0?6:e-1];const{data:x}=await N.get(`${R}/api/calendar/info/${V.id}`,{headers:{token:T().token}});if(x.ok)v.value=x.msg.eps,g.value=x.msg.updates;else if(x.msg=="令牌已过期"){if(!o&&await T().refreshToken()){U(V,e,!0);return}}else a.add({severity:"error",summary:"获取信息失败",detail:x.msg,life:3e3});m.value.loadingHandler(!1,"加载番剧信息")},j=async()=>{if(s.value.length==0){a.add({severity:"error",summary:"添加失败",detail:"标题不能为空",life:3e3});return}else if(v.value.length==0){a.add({severity:"error",summary:"添加失败",detail:"集数不能为空",life:3e3});return}else if(w.value.length==0){a.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(g.value.length==0&&t.value){a.add({severity:"error",summary:"添加失败",detail:"观看集数不能为空",life:3e3});return}else if(t.value&&parseInt(g.value)==0){a.add({severity:"error",summary:"添加失败",detail:"更新集数不能为0",life:3e3});return}c().addItem(s.value,t.value,parseInt(v.value),parseInt(w.value),parseInt(g.value),i.value.code),_().getList(),r.value=!1};return p({showAddHandler:U}),(V,e)=>(f(),b(C,null,[n(l(I),{visible:r.value,"onUpdate:visible":e[7]||(e[7]=o=>r.value=o),modal:"",header:"添加到列表...",style:{width:"25rem"},draggable:!1,class:"select-none",closable:!1},{default:y(()=>[u("div",Y,[n(l(F),{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value=o),inputId:"update",binary:""},null,8,["modelValue"]),e[8]||(e[8]=u("label",{for:"update"}," 当前在更新 ",-1))]),u("div",Z,[e[9]||(e[9]=u("label",{for:"title",class:"font-semibold w-20"},"标题",-1)),n(l($),{size:"small",id:"title",class:"flex-auto",autocomplete:"off",modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o)},null,8,["modelValue"])]),u("div",ee,[e[10]||(e[10]=u("label",{for:"episode",class:"font-semibold w-20"},"集数",-1)),n(l($),{type:"number",size:"small",id:"episode",class:"flex-auto",autocomplete:"off",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),min:"1"},null,8,["modelValue"])]),u("div",le,[e[11]||(e[11]=u("label",{for:"watchTo",class:"font-semibold w-20"},"观看至",-1)),n(l($),{type:"number",size:"small",id:"watchTo",class:"flex-auto",autocomplete:"off",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),min:"0",max:t.value?g.value:v.value},null,8,["modelValue","max"])]),t.value?(f(),b("div",ae,[e[12]||(e[12]=u("label",{for:"updateTo",class:"font-semibold w-20"},"更新至",-1)),n(l($),{type:"number",size:"small",id:"updateTo",class:"flex-auto",autocomplete:"off",modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),min:"1",max:v.value},null,8,["modelValue","max"])])):L("",!0),t.value?(f(),b("div",se,[e[13]||(e[13]=u("label",{for:"updateWeek",class:"font-semibold w-20"},"更新周",-1)),n(l(S),{size:"small",id:"updateWeek",modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value=o),options:l(c)().weekdays,"scroll-height":"20rem",optionLabel:"name"},null,8,["modelValue","options"])])):L("",!0),u("div",te,[n(l(h),{type:"button",label:"取消",severity:"secondary",onClick:e[6]||(e[6]=o=>r.value=!1),size:"small"}),n(l(h),{type:"button",label:"添加",onClick:j,size:"small"})])]),_:1},8,["visible"]),n(X,{ref_key:"loadingRef",ref:m},null,512)],64))}}),re={class:"page"},pe=H({__name:"calendar",setup(k){document.title="AnimeHelper | 每日放送";const p=d(),m=(r,i)=>{r.added||p.value.showAddHandler(r,i)};return E(async()=>{await _().getList(),c().list.length==0&&await c().getList()}),(r,i)=>(f(),b("div",re,[n(l(J),{multiple:!0,value:[0,1,2,3,4,5,6]},{default:y(()=>[(f(!0),b(C,null,A(l(_)().list,(a,s)=>(f(),z(l(K),{key:s,value:s},{default:y(()=>[n(l(O),null,{default:y(()=>[M(q(l(c)().weekdays[s==0?6:s-1].name),1)]),_:2},1024),n(l(P),null,{default:y(()=>[(f(!0),b(C,null,A(a,(t,v)=>(f(),z(l(Q),{rounded:"",key:t.id,value:t.title,class:G(t.added?"select-none m-1":"select-none m-1 cursor-pointer"),severity:l(_)().added(t.title)?"warn":"secondary",onClick:w=>m(t,s)},null,8,["value","class","severity","onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),n(oe,{ref_key:"addRef",ref:p},null,512)]))}});export{pe as default};
